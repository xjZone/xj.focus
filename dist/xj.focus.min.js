/** xj.focus(区分聚焦模式) | V0.3.2 | Apache Licence 2.0 | 2018-2021 © XJ.Chen | https://github.com/xjZone/xj.focus */
!function(a,b){"function"!=typeof define||void 0===define.amd&&void 0===define.cmd?"undefined"!=typeof module&&"object"==typeof exports?module.exports=b():(a=a||self,a.xj||(a.xj={}),a.xj.focus=b()):define(b)}(this,function(){"use strict";var a,b,c,d,e,f,h,i,j,k,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;return!function(){var a=window.Element.prototype;"function"!=typeof a.matches&&(a.matches=a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||function(a){for(var b=this,c=(b.document||b.ownerDocument).querySelectorAll(a),d=0;c[d]&&c[d]!==b;)++d;return Boolean(c[d])}),"function"!=typeof a.closest&&(a.closest=function(a){for(var b=this;b&&1===b.nodeType;){if(b.matches(a))return b;b=b.parentNode}return null})}(),!function(){a=function(a,b){var c,d;return a.classList?a.classList.contains(b):(c=a.getAttribute("class"),d=c?c.split(/\s+/):[],-1===d.indexOf(b)?!1:!0)},b=function(a,b){var c,d;return a.classList?a.classList.add(b):(c=a.getAttribute("class"),d=c?c.split(/\s+/):[],0===d.length?a.setAttribute("class",b):-1===d.indexOf(b)&&a.setAttribute("class",d.join(" ")+" "+b),void 0)},c=function(a,b){var c,d;return a.classList?a.classList.remove(b):(c=a.getAttribute("class"),d=c?c.split(/\s+/):[],c="",-1!==d.indexOf(b)&&(d.forEach(function(a){a!==b&&(c+=a+" ")}),a.setAttribute("class",c.trim())),void 0)}}(),d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:global,e=function(){},f="0.3.2",h={classTarget:document.documentElement,existClass:"xj-focus-exist",debug:!1,time:200,initializedFocus:"ontab",visibilityFocus:"ontab",automaticFocus:"ontap",dispatchFocus:"other",elementFocus:"ontab",frameStyle:"auto",shadowClass:"xj-focus-shadow",outlineClass:"xj-focus-outline",ontabClass:"xj-focus-ontab",ontapClass:"xj-focus-ontap",otherClass:"xj-focus-other",ontabFixedClass:"xj-focus-ontab-fixed",ontapFixedClass:"xj-focus-ontap-fixed",otherFixedClass:"xj-focus-other-fixed",ontabAlways:["textarea",'input:not([type="button"]):not([type="submit"]):not([type="reset"]):not([type="file"]):not([type="image"]):not([type="radio"]):not([type="checkbox"]):not([type="range"]):not([type="color"])'],ontapAlways:["audio","video"],otherAlways:["area","svg a"],modifiableTag:"ontab",ontabCallback:e,ontapCallback:e,otherCallback:e},i={},void 0===d.xj&&(d.xj={}),void 0===d.xj.focusReturn&&(d.xj.focusReturn={}),void 0!==d.xj.focusReturn[f]?d.xj.focusReturn[f]:(void 0===d.xj.focusConfig&&(d.xj.focusConfig={}),void 0===d.xj.focusOption&&(d.xj.focusOption={}),void 0!==d.xj.focusConfig[f]&&Object.keys(d.xj.focusConfig[f]).forEach(function(a){h[a]=d.xj.focusConfig[f][a]}),void 0!==d.xj.focusOption[f]&&Object.keys(d.xj.focusOption[f]).forEach(function(a){i[a]=d.xj.focusOption[f][a]}),j=d,k=j.document,k.documentElement,k.body,n=h.shadowClass,("outline"===h.frameStyle||"auto"===h.frameStyle&&/Apple/i.test(navigator.vendor)===!0)&&(n=h.outlineClass),o={version:f,ontab:!1,ontap:!1,other:!1,ontabSet:function(a){(h.ontabCallback===e||h.ontabCallback(a)!==!1)&&(o.ontab=!0,o.ontap=!1,o.other=!1,b(a,n),b(a,h.ontabClass),c(a,h.ontapClass),c(a,h.otherClass))},ontapSet:function(a){(h.ontapCallback===e||h.ontapCallback(a)!==!1)&&(o.ontab=!1,o.ontap=!0,o.other=!1,b(a,n),c(a,h.ontabClass),b(a,h.ontapClass),c(a,h.otherClass))},otherSet:function(a){(h.otherCallback===e||h.otherCallback(a)!==!1)&&(o.ontab=!1,o.ontap=!1,o.other=!0,b(a,n),c(a,h.ontabClass),c(a,h.ontapClass),b(a,h.otherClass))}},p=null,q=function(a){for(var b=!1,c=p;b===!1&&null!==c&&void 0!==c&&1===c.nodeType;)/^label$/i.test(c.nodeName)===!0||c===a?b=!0:c=c.parentElement;return b},r=!1,s=function(a,b){switch(r=!1,b){case"ontab":w(a,!0);break;case"ontap":x(a,!0);break;case"other":y(a,!0)}},t=/Firefox/i.test(navigator.userAgent)===!0?"MozUserModify":"webkitUserModify",u=function(a,b){return j.getComputedStyle(a,b?b:null)},v=function(a){return/^input|textarea$/i.test(a.nodeName)===!0?!1:a.isContentEditable===!0||void 0===k.documentMode&&/write/i.test(u(a)[t])===!0?!0:!1},w=function(a,b){var c=!1,d=0,e=0;if(b===!0){if(v(a.target)===!0){if("ontab"===h.modifiableTag)return w(a,!1);if("ontap"===h.modifiableTag)return x(a,!1);if("other"===h.modifiableTag)return y(a,!1)}for(d=0,e=h.ontapAlways.length;e>d;d++)if(a.target.matches(h.ontapAlways[d])===!0){x(a,!1),c=!0;break}if(c===!0)return;for(d=0,e=h.otherAlways.length;e>d;d++)if(a.target.matches(h.otherAlways[d])===!0){y(a,!1),c=!0;break}if(c===!0)return}o.ontabSet(a.target)},x=function(a,b){var c=!1,d=0,e=0;if(b===!0){if(v(a.target)===!0){if("ontab"===h.modifiableTag)return w(a,!1);if("ontap"===h.modifiableTag)return x(a,!1);if("other"===h.modifiableTag)return y(a,!1)}for(d=0,e=h.ontabAlways.length;e>d;d++)if(a.target.matches(h.ontabAlways[d])===!0){w(a,!1),c=!0;break}if(c===!0)return;for(d=0,e=h.otherAlways.length;e>d;d++)if(a.target.matches(h.otherAlways[d])===!0){y(a,!1),c=!0;break}if(c===!0)return}o.ontapSet(a.target)},y=function(a,b){var c=!1,d=0,e=0;if(b===!0){if(v(a.target)===!0){if("ontab"===h.modifiableTag)return w(a,!1);if("ontap"===h.modifiableTag)return x(a,!1);if("other"===h.modifiableTag)return y(a,!1)}for(d=0,e=h.ontabAlways.length;e>d;d++)if(a.target.matches(h.ontabAlways[d])===!0){w(a,!1),c=!0;break}if(c===!0)return;for(d=0,e=h.ontapAlways.length;e>d;d++)if(a.target.matches(h.ontapAlways[d])===!0){x(a,!1),c=!0;break}if(c===!0)return}o.otherSet(a.target)},function(){var a,b,c;void 0!==document.documentMode&&(a=/^input|textarea|select|button|audio|video|area|svg|a|iframe|embed|object$/i,b=null,c=void 0,s=function(d,e){if(r=!1,b=d.target,c=b.getAttribute("tabIndex"),a.test(b.nodeName)===!0||b.isContentEditable===!0||void 0!==c&&null!==c&&""!==c&&c>=0)switch(e){case"ontab":w(d,!0);break;case"ontap":x(d,!0);break;case"other":y(d,!0)}})}(),function(){var a=null,b=!1;try{a=k.createElement("input"),a.type="color",a.value="!",b="color"===a.type&&"!"!==a.value}catch(c){}b===!1&&h.ontabAlways.forEach(function(a,b){-1!==a.indexOf(':not([type="color"])')&&(h.ontabAlways[b]=a.replace(':not([type="color"])',""))})}(),z=0,A=0,B=0,C=0,k.addEventListener("DOMContentLoaded",function(a){a.isTrusted!==!1&&(z=Date.now())},!0),k.addEventListener("visibilitychange",function(a){a.isTrusted!==!1&&(A=Date.now())},!0),k.addEventListener("keydown",function(a){-1!==[9,37,38,39,40].indexOf(a.keyCode)&&a.isTrusted!==!1&&(B=Date.now())},!0),["mousedown","touchstart"].forEach(function(a){k.addEventListener(a,function(a){a.isTrusted!==!1&&(p=a.target,C=Date.now())},!0)}),D=0,j.addEventListener("focus",function(b){return 1===b.target.nodeType?a(b.target,h.ontabFixedClass)===!0?w(b,!1):a(b.target,h.ontapFixedClass)===!0?x(b,!1):a(b.target,h.otherFixedClass)===!0?y(b,!1):b.isTrusted===!1?(s(b,h.dispatchFocus),void 0):(D=Date.now(),D-z<=h.time?(s(b,h.initializedFocus),void 0):D-A<=h.time?(s(b,h.visibilityFocus),void 0):r===!0?(s(b,h.automaticFocus),void 0):D-B<=h.time?(w(b,!0),void 0):D-C<=h.time&&q(b.target)===!0?(x(b,!0),void 0):(s(b,h.elementFocus),void 0)):void 0},!0),j.addEventListener("blur",function(a){a.isTrusted===!0&&a.target===j&&(r=!0),o.other=!1,o.ontab=!1,o.ontap=!1,h.debug!==!0&&(E=k.querySelectorAll("."+n),F=k.querySelectorAll("."+h.ontabClass),G=k.querySelectorAll("."+h.ontapClass),H=k.querySelectorAll("."+h.otherClass),E.length>0&&Array.prototype.forEach.call(E,function(a){c(a,n)}),F.length>0&&Array.prototype.forEach.call(F,function(a){c(a,h.ontabClass)}),G.length>0&&Array.prototype.forEach.call(G,function(a){c(a,h.ontapClass)}),H.length>0&&Array.prototype.forEach.call(H,function(a){c(a,h.otherClass)}))},!0),null!==h.classTarget&&""!==h.existClass&&b(h.classTarget,h.existClass),d.xj.focusReturn[f]=o)});
