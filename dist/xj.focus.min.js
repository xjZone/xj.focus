/** xj.focus(区分聚焦模式) | V0.3.0 | Apache Licence 2.0 | 2018-2021 © XJ.Chen | https://github.com/xjZone/xj.focus */
!function(a,b){"function"!=typeof define||void 0===define.amd&&void 0===define.cmd?"undefined"!=typeof module&&"object"==typeof exports?module.exports=b():(a=a||self,a.xj||(a.xj={}),a.xj.focus=b()):define(b)}(this,function(){"use strict";var a,b,c,d,e,f,h,i,j,k,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;return!function(){var a=window.Element.prototype;"function"!=typeof a.matches&&(a.matches=a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||function(a){for(var b=this,c=(b.document||b.ownerDocument).querySelectorAll(a),d=0;c[d]&&c[d]!==b;)++d;return Boolean(c[d])}),"function"!=typeof a.closest&&(a.closest=function(a){for(var b=this;b&&1===b.nodeType;){if(b.matches(a))return b;b=b.parentNode}return null})}(),!function(){a=function(a,b){var c,d;return a.classList?a.classList.contains(b):(c=a.getAttribute("class"),d=c?c.split(/\s+/):[],-1===d.indexOf(b)?!1:!0)},b=function(a,b){var c,d;return a.classList?a.classList.add(b):(c=a.getAttribute("class"),d=c?c.split(/\s+/):[],0===d.length?a.setAttribute("class",b):-1===d.indexOf(b)&&a.setAttribute("class",d.join(" ")+" "+b),void 0)},c=function(a,b){var c,d;return a.classList?a.classList.remove(b):(c=a.getAttribute("class"),d=c?c.split(/\s+/):[],c="",-1!==d.indexOf(b)&&(d.forEach(function(a){a!==b&&(c+=a+" ")}),a.setAttribute("class",c.trim())),void 0)}}(),d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:global,e=function(){},f="0.3.0",h={classTarget:document.documentElement,existClass:"xj-focus-exist",debug:!1,time:200,initializedFocus:"ontab",visibilityFocus:"ontab",automaticFocus:"ontap",dispatchFocus:"other",elementFocus:"ontab",ontabClass:"xj-focus-ontab",ontapClass:"xj-focus-ontap",otherClass:"xj-focus-other",ontabFixedClass:"xj-focus-ontab-fixed",ontapFixedClass:"xj-focus-ontap-fixed",otherFixedClass:"xj-focus-other-fixed",ontabAlways:["textarea",'input:not([type="button"]):not([type="submit"]):not([type="reset"]):not([type="file"]):not([type="image"]):not([type="radio"]):not([type="checkbox"]):not([type="range"]):not([type="color"])'],ontapAlways:["audio","video"],otherAlways:["area","svg a"],ontabCallback:e,ontapCallback:e,otherCallback:e},i={},void 0===d.xj&&(d.xj={}),void 0===d.xj.focusReturn&&(d.xj.focusReturn={}),void 0!==d.xj.focusReturn[f]?d.xj.focusReturn[f]:(void 0===d.xj.focusConfig&&(d.xj.focusConfig={}),void 0===d.xj.focusOption&&(d.xj.focusOption={}),void 0!==d.xj.focusConfig[f]&&Object.keys(d.xj.focusConfig[f]).forEach(function(a){h[a]=d.xj.focusConfig[f][a]}),void 0!==d.xj.focusOption[f]&&Object.keys(d.xj.focusOption[f]).forEach(function(a){i[a]=d.xj.focusOption[f][a]}),j=d,k=j.document,k.documentElement,k.body,n={version:f,ontab:!1,ontap:!1,other:!1,ontabSet:function(a){(h.ontabCallback===e||h.ontabCallback(a)!==!1)&&(n.ontab=!0,n.ontap=!1,n.other=!1,b(a,h.ontabClass),c(a,h.ontapClass),c(a,h.otherClass))},ontapSet:function(a){(h.ontapCallback===e||h.ontapCallback(a)!==!1)&&(n.ontab=!1,n.ontap=!0,n.other=!1,c(a,h.ontabClass),b(a,h.ontapClass),c(a,h.otherClass))},otherSet:function(a){(h.otherCallback===e||h.otherCallback(a)!==!1)&&(n.ontab=!1,n.ontap=!1,n.other=!0,c(a,h.ontabClass),c(a,h.ontapClass),b(a,h.otherClass))}},o=null,p=function(a){for(var b=!1,c=o;b===!1&&null!==c&&1===c.nodeType;)/^label$/i.test(c.nodeName)===!0||c===a?b=!0:c=c.parentElement;return b},q=!1,r=function(a,b){switch(q=!1,b){case"ontab":v(a,!0);break;case"ontap":w(a,!0);break;case"other":x(a,!0)}},s=/Firefox/i.test(navigator.userAgent)===!0?"MozUserModify":"webkitUserModify",t=function(a,b){return j.getComputedStyle(a,b?b:null)},u=function(a){return/^input|textarea$/i.test(a.nodeName)===!0?!1:a.isContentEditable===!0||void 0===k.documentMode&&/write/i.test(t(a)[s])===!0?!0:!1},v=function(a,b){var c=!1,d=0,e=0;if(b===!0){for(d=0,e=h.ontapAlways.length;e>d;d++)if(a.target.matches(h.ontapAlways[d])===!0){w(a,!1),c=!0;break}if(c===!0)return;for(d=0,e=h.otherAlways.length;e>d;d++)if(a.target.matches(h.otherAlways[d])===!0){x(a,!1),c=!0;break}if(c===!0)return}n.ontabSet(a.target)},w=function(a,b){var c=!1,d=0,e=0;if(b===!0){if(u(a.target)===!0)return v(a,!1);for(d=0,e=h.ontabAlways.length;e>d;d++)if(a.target.matches(h.ontabAlways[d])===!0){v(a,!1),c=!0;break}if(c===!0)return;for(d=0,e=h.otherAlways.length;e>d;d++)if(a.target.matches(h.otherAlways[d])===!0){x(a,!1),c=!0;break}if(c===!0)return}n.ontapSet(a.target)},x=function(a,b){var c=!1,d=0,e=0;if(b===!0){if(u(a.target)===!0)return v(a,!1);for(d=0,e=h.ontabAlways.length;e>d;d++)if(a.target.matches(h.ontabAlways[d])===!0){v(a,!1),c=!0;break}if(c===!0)return;for(d=0,e=h.ontapAlways.length;e>d;d++)if(a.target.matches(h.ontapAlways[d])===!0){w(a,!1),c=!0;break}if(c===!0)return}n.otherSet(a.target)},function(){var a,b,c;void 0!==document.documentMode&&(a=/^input|textarea|select|button|audio|video|area|svg|a|iframe|embed|object$/i,b=null,c=void 0,r=function(d,e){if(q=!1,b=d.target,c=b.getAttribute("tabIndex"),a.test(b.nodeName)===!0||b.isContentEditable===!0||void 0!==c&&null!==c&&""!==c&&c>=0)switch(e){case"ontab":v(d,!0);break;case"ontap":w(d,!0);break;case"other":x(d,!0)}})}(),function(){var a=null,b=!1;try{a=k.createElement("input"),a.type="color",a.value="!",b="color"===a.type&&"!"!==a.value}catch(c){}b===!1&&h.ontabAlways.forEach(function(a,b){-1!==a.indexOf(':not([type="color"])')&&(h.ontabAlways[b]=a.replace(':not([type="color"])',""))})}(),y=0,z=0,A=0,B=0,k.addEventListener("DOMContentLoaded",function(a){a.isTrusted!==!1&&(y=Date.now())},!0),k.addEventListener("visibilitychange",function(a){a.isTrusted!==!1&&(z=Date.now())},!0),k.addEventListener("keydown",function(a){-1!==[9,37,38,39,40].indexOf(a.keyCode)&&a.isTrusted!==!1&&(A=Date.now())},!0),["mousedown","touchstart"].forEach(function(a){k.addEventListener(a,function(a){a.isTrusted!==!1&&(o=a.target,B=Date.now())},!0)}),C=0,j.addEventListener("focus",function(b){return 1===b.target.nodeType?a(b.target,h.ontabFixedClass)===!0?v(b,!1):a(b.target,h.ontapFixedClass)===!0?w(b,!1):a(b.target,h.otherFixedClass)===!0?x(b,!1):b.isTrusted===!1?(r(b,h.dispatchFocus),void 0):(C=Date.now(),C-y<=h.time?(r(b,h.initializedFocus),void 0):C-z<=h.time?(r(b,h.visibilityFocus),void 0):q===!0?(r(b,h.automaticFocus),void 0):C-A<=h.time?(v(b,!0),void 0):C-B<=h.time&&p(b.target)===!0?(w(b,!0),void 0):(r(b,h.elementFocus),void 0)):void 0},!0),j.addEventListener("blur",function(a){a.isTrusted===!0&&a.target===j&&(q=!0),n.other=!1,n.ontab=!1,n.ontap=!1,h.debug!==!0&&(D=k.querySelectorAll("."+h.ontabClass),E=k.querySelectorAll("."+h.ontapClass),F=k.querySelectorAll("."+h.otherClass),D.length>0&&Array.prototype.forEach.call(D,function(a){c(a,h.ontabClass)}),E.length>0&&Array.prototype.forEach.call(E,function(a){c(a,h.ontapClass)}),F.length>0&&Array.prototype.forEach.call(F,function(a){c(a,h.otherClass)}))},!0),null!==h.classTarget&&""!==h.existClass&&b(h.classTarget,h.existClass),d.xj.focusReturn[f]=n)});
